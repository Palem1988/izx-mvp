var abi = require('ethereumjs-abi');

var IzxCharity = function(connection) {

    this.connection = connection;

    this.abi = [{"constant":false,"inputs":[{"name":"donation_index","type":"uint256"},{"name":"transaction_hash","type":"string"}],"name":"transfer_donation","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"site_url","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"donation_index","type":"uint256"},{"name":"transaction_hash","type":"string"}],"name":"return_donation","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"wallet","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"collected_amount","outputs":[{"name":"collected","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"donator","type":"address"},{"name":"donated_amount","type":"uint256"},{"name":"transaction_hash","type":"string"}],"name":"accept_donation","outputs":[{"name":"index","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"required_amount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"description","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"image_url","outputs":[{"name":"","type":"string"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"remaining_amount","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"transfered_amount","outputs":[{"name":"transfered","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"donations_num","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"last_donation","outputs":[{"name":"donator","type":"address"},{"name":"amount","type":"uint256"},{"name":"donate_transaction_hash","type":"string"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"donation_index","type":"uint256"}],"name":"donation","outputs":[{"name":"donator","type":"address"},{"name":"amount","type":"uint256"},{"name":"donate_transaction_hash","type":"string"},{"name":"transfer_transaction_hash","type":"string"},{"name":"return_transaction_hash","type":"string"}],"payable":false,"type":"function"},{"inputs":[{"name":"_token","type":"address"},{"name":"_wallet","type":"address"},{"name":"_required_amount","type":"uint256"},{"name":"_name","type":"string"},{"name":"_description","type":"string"},{"name":"_image_url","type":"string"},{"name":"_site_url","type":"string"}],"payable":false,"type":"constructor"}];

    this.deploy = function(token,
                           wallet,
                           required_amount,
                           name,
                           description,
                           image_url,
                           site_url,
                           callback){
        this.connection.web3.eth.contract(this.abi).new(
            token,
            wallet,
            required_amount,
            name,
            description,
            image_url,
            site_url,
            {
                from: this.connection.address,
                data: '0x6060604052600060085534156200001557600080fd5b604051620017b1380380620017b1833981016040528080519060200190919080519060200190919080519060200190919080518201919060200180518201919060200180518201919060200180518201919050505b5b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b86600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555085600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508460038190555083600490805190602001906200014d929190620001a7565b50826005908051906020019062000166929190620001a7565b5081600690805190602001906200017f929190620001a7565b50806007908051906020019062000198929190620001a7565b505b5050505050505062000256565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620001ea57805160ff19168380011785556200021b565b828001600101855582156200021b579182015b828111156200021a578251825591602001919060010190620001fd565b5b5090506200022a91906200022e565b5090565b6200025391905b808211156200024f57600081600090555060010162000235565b5090565b90565b61154b80620002666000396000f300606060405236156100fa576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306d295a3146100ff57806306fdde03146101655780632326df93146101f457806323bb80b514610283578063521eb273146102e9578063546a04cf1461033e57806367401667146103675780637169cddc146104005780637284e41614610429578063824f4baf146104b857806382dd9b84146105475780638da5cb5b14610570578063935d6579146105c55780639dfb518b146105ee578063aadfc6c514610617578063f2fde38b146106e0578063fc0c546a14610719578063fdac32541461076e575b600080fd5b341561010a57600080fd5b610163600480803590602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190505061091f565b005b341561017057600080fd5b6101786109c8565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101b95780820151818401525b60208101905061019d565b50505050905090810190601f1680156101e65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156101ff57600080fd5b610207610a66565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102485780820151818401525b60208101905061022c565b50505050905090810190601f1680156102755780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561028e57600080fd5b6102e7600480803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610b04565b005b34156102f457600080fd5b6102fc610bad565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561034957600080fd5b610351610bd3565b6040518082815260200191505060405180910390f35b341561037257600080fd5b6103ea600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091905050610c1a565b6040518082815260200191505060405180910390f35b341561040b57600080fd5b610413610dc1565b6040518082815260200191505060405180910390f35b341561043457600080fd5b61043c610dc7565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561047d5780820151818401525b602081019050610461565b50505050905090810190601f1680156104aa5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156104c357600080fd5b6104cb610e65565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561050c5780820151818401525b6020810190506104f0565b50505050905090810190601f1680156105395780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561055257600080fd5b61055a610f03565b6040518082815260200191505060405180910390f35b341561057b57600080fd5b610583610f1a565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156105d057600080fd5b6105d8610f3f565b6040518082815260200191505060405180910390f35b34156105f957600080fd5b610601610fba565b6040518082815260200191505060405180910390f35b341561062257600080fd5b61062a610fc0565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b838110156106a35780820151818401525b602081019050610687565b50505050905090810190601f1680156106d05780820380516001836020036101000a031916815260200191505b5094505050505060405180910390f35b34156106eb57600080fd5b610717600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506110bb565b005b341561072457600080fd5b61072c61115b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561077957600080fd5b61078f6004808035906020019091905050611181565b604051808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001858152602001806020018060200180602001848103845287818151815260200191508051906020019080838360005b838110156108105780820151818401525b6020810190506107f4565b50505050905090810190601f16801561083d5780820380516001836020036101000a031916815260200191505b50848103835286818151815260200191508051906020019080838360005b838110156108775780820151818401525b60208101905061085b565b50505050905090810190601f1680156108a45780820380516001836020036101000a031916815260200191505b50848103825285818151815260200191508051906020019080838360005b838110156108de5780820151818401525b6020810190506108c2565b50505050905090810190601f16801561090b5780820380516001836020036101000a031916815260200191505b509850505050505050505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561097a57600080fd5b6008548210801561098c575060008210155b151561099757600080fd5b806009600084815260200190815260200160002060030190805190602001906109c19291906113e6565b505b5b5050565b60048054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a5e5780601f10610a3357610100808354040283529160200191610a5e565b820191906000526020600020905b815481529060010190602001808311610a4157829003601f168201915b505050505081565b60078054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610afc5780601f10610ad157610100808354040283529160200191610afc565b820191906000526020600020905b815481529060010190602001808311610adf57829003601f168201915b505050505081565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610b5f57600080fd5b60085482108015610b71575060008210155b1515610b7c57600080fd5b80600960008481526020019081526020016000206004019080519060200190610ba69291906113e6565b505b5b5050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060009150600090505b600854811015610c12576009600082815260200190815260200160002060010154820191505b8080600101915050610bdf565b8191505b5090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610c7757600080fd5b600083111515610c8657600080fd5b600854905060a0604051908101604052808573ffffffffffffffffffffffffffffffffffffffff1681526020018481526020018381526020016020604051908101604052806000815250815260200160206040519081016040528060008152508152506009600083815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101556040820151816002019080519060200190610d69929190611466565b506060820151816003019080519060200190610d86929190611466565b506080820151816004019080519060200190610da3929190611466565b5090505060016008600082825401925050819055505b5b9392505050565b60035481565b60058054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610e5d5780601f10610e3257610100808354040283529160200191610e5d565b820191906000526020600020905b815481529060010190602001808311610e4057829003601f168201915b505050505081565b60068054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610efb5780601f10610ed057610100808354040283529160200191610efb565b820191906000526020600020905b815481529060010190602001808311610ede57829003601f168201915b505050505081565b6000610f0d610bd3565b6003540390508090505b90565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008060009150600090505b600854811015610fb2576000600960008381526020019081526020016000206003018054600181600116156101000203166002900490501115610fa4576009600082815260200190815260200160002060010154820191505b5b8080600101915050610f4b565b8191505b5090565b60085481565b600080610fcb6114e6565b600060096000600160085403815260200190815260200160002090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16935080600101549250806002018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156110ad5780601f10611082576101008083540402835291602001916110ad565b820191906000526020600020905b81548152906001019060200180831161109057829003601f168201915b505050505091505b50909192565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561111657600080fd5b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b50565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60008061118c6114e6565b6111946114e6565b61119c6114e6565b6000600854871080156111b0575060008710155b15156111bb57600080fd5b6009600088815260200190815260200160002090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16955080600101549450806002018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112965780601f1061126b57610100808354040283529160200191611296565b820191906000526020600020905b81548152906001019060200180831161127957829003601f168201915b50505050509350806003018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113355780601f1061130a57610100808354040283529160200191611335565b820191906000526020600020905b81548152906001019060200180831161131857829003601f168201915b50505050509250806004018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156113d45780601f106113a9576101008083540402835291602001916113d4565b820191906000526020600020905b8154815290600101906020018083116113b757829003601f168201915b505050505091505b5091939590929450565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061142757805160ff1916838001178555611455565b82800160010185558215611455579182015b82811115611454578251825591602001919060010190611439565b5b50905061146291906114fa565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106114a757805160ff19168380011785556114d5565b828001600101855582156114d5579182015b828111156114d45782518255916020019190600101906114b9565b5b5090506114e291906114fa565b5090565b602060405190810160405280600081525090565b61151c91905b80821115611518576000816000905550600101611500565b5090565b905600a165627a7a72305820d273dc4e58070791f89b4002cdececb60cb7d844269dd6145ce47f27991d3eae0029',
                gas: '4700000'
            }, callback)
    }

}

IzxCharity.prototype.constructor_args = function(token,
                                                 wallet,
                                                 required_amount,
                                                 name,
                                                 description,
                                                 image_url,
                                                 site_url){
    var x = abi.simpleEncode("constructor(address,address,uint256,string,string,string,string)",
        token,wallet,required_amount,name,description,image_url,site_url);

    return x.toString("hex").substring(8);
}


module.exports = IzxCharity;